<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SteppeTune</title>
    <link rel="stylesheet" href="css/style.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600&display=swap" rel="stylesheet">
</head>

<body>
    <div class="cursor"></div>
    
    <!-- ÐÐ°Ð²Ð¸Ð³Ð°Ñ†Ð¸Ñ -->
    <header>
        <div class="logo">
            <img src="images/image 9.png" alt="ÐžÐ¿Ð¸ÑÐ°Ð½Ð¸Ðµ" class="img">
            <a href="Ð¿Ñ€Ð¾Ð±Ð½Ñ‹Ð¹2.html">SteppeTune</a>
        </div>
        <nav>
            <a href="#">Discover</a>
            <a href="login.html">Join</a>
        </nav>
    </header>

    <!-- Ð ÐµÐ³Ð¸ÑÑ‚Ñ€Ð°Ñ†Ð¸Ñ -->
    
    <section class="signup">
        <h2>Login to SteppeTune</h2>
        <form>
            <input type="email" placeholder="Email" id="email">
            <input type="password" placeholder="Password" id="password">
            <button type="submit">Login</button>
        </form>
    </section>

    <!-- ÐŸÐ¾Ð´Ð²Ð°Ð» -->
    <footer>
        <p>About Us | Contact</p>
        <div class="socials">
            <a href="main.html"><img src="icons copy/facebook.png" alt="Facebook"></a>
            <a href="main.html"><img src="icons copy//instagram.png" alt="Instagram"></a>
            <a href="main.html"><img src="icons copy/youtube.png" alt="YouTube"></a>
            <a href="main.html"><img src="icons copy/twitter.png" alt="Twitter"></a>
            <a href="main.html"><img src="icons copy/itunes.png" alt="iTunes"></a>
            <a href="main.html"><img src="icons copy/spotify.png" alt="Spotify"></a>
            <a href="main.html#mail"><img src="icons copy/mail.png" alt="Telegram"></a>
        </div>
    </footer>


    <script>
        document.querySelector('.signup form').addEventListener('submit', async function (event) {
        event.preventDefault();

        const email = document.querySelector('#email').value;
        const password = document.querySelector('#password').value;

        try {
            // ðŸ”¹ ÐžÑ‡Ð¸Ñ‰Ð°ÐµÐ¼ ÑÑ‚Ð°Ñ€Ñ‹Ðµ Ð´Ð°Ð½Ð½Ñ‹Ðµ Ð¿ÐµÑ€ÐµÐ´ Ð²Ñ…Ð¾Ð´Ð¾Ð¼ (ÐµÑÐ»Ð¸ Ð²Ð´Ñ€ÑƒÐ³ Ð¾ÑÑ‚Ð°Ð»Ð¸ÑÑŒ)
            localStorage.removeItem("userId");
            localStorage.removeItem("token");

            // ðŸ”¹ ÐžÑ‚Ð¿Ñ€Ð°Ð²Ð»ÑÐµÐ¼ Ð·Ð°Ð¿Ñ€Ð¾Ñ Ð½Ð° ÑÐµÑ€Ð²ÐµÑ€ (http://localhost:5000/login)
            const response = await fetch('http://localhost:5000/login', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ email, password })
            });

            if (!response.ok) {
                throw new Error("ÐžÑˆÐ¸Ð±ÐºÐ° Ð°Ð²Ñ‚Ð¾Ñ€Ð¸Ð·Ð°Ñ†Ð¸Ð¸");
            }

            const result = await response.json(); // âœ… ÐŸÐ¾Ð»ÑƒÑ‡Ð°ÐµÐ¼ Ð¾Ñ‚Ð²ÐµÑ‚ Ð¾Ñ‚ ÑÐµÑ€Ð²ÐµÑ€Ð°

            // ðŸ”¹ ÐŸÑ€Ð¾Ð²ÐµÑ€ÑÐµÐ¼, ÐµÑÑ‚ÑŒ Ð»Ð¸ `token` Ð¸ `userId`
            if (result.token && result.userId) {
                console.log("âœ… Ð£ÑÐ¿ÐµÑˆÐ½Ñ‹Ð¹ Ð²Ñ…Ð¾Ð´, userId:", result.userId);
                
                // âœ… Ð¡Ð¾Ñ…Ñ€Ð°Ð½ÑÐµÐ¼ Ð´Ð°Ð½Ð½Ñ‹Ðµ Ð² `localStorage`
                localStorage.setItem('token', result.token);
                localStorage.setItem('userId', result.userId);

                console.log("ðŸ”¹ Ð¡Ð¾Ñ…Ñ€Ð°Ð½Ñ‘Ð½ userId Ð¿ÐµÑ€ÐµÐ´ Ñ€ÐµÐ´Ð¸Ñ€ÐµÐºÑ‚Ð¾Ð¼:", localStorage.getItem("userId"));

                // ðŸ”„ ÐŸÐµÑ€ÐµÐ½Ð°Ð¿Ñ€Ð°Ð²Ð»ÑÐµÐ¼ Ð½Ð° Ð´Ñ€ÑƒÐ³Ð¾Ð¹ Ñ…Ð¾ÑÑ‚ (http://localhost:5000/home)
                setTimeout(() => {
                    window.location.href = `http://localhost:3000/home?token=${result.token}&userId=${result.userId}`;
                }, 500); // Ð–Ð´Ñ‘Ð¼ 500 Ð¼Ñ Ð¿ÐµÑ€ÐµÐ´ Ñ€ÐµÐ´Ð¸Ñ€ÐµÐºÑ‚Ð¾Ð¼

            } else {
                alert("ÐžÑˆÐ¸Ð±ÐºÐ°: Ð½ÐµÐ²ÐµÑ€Ð½Ñ‹Ðµ ÑƒÑ‡ÐµÑ‚Ð½Ñ‹Ðµ Ð´Ð°Ð½Ð½Ñ‹Ðµ");
            }
        } catch (error) {
            console.error("âŒ ÐžÑˆÐ¸Ð±ÐºÐ° Ð²Ñ…Ð¾Ð´Ð°:", error);
            alert(error.message);
        }
    });


    
        // ÐÐ°Ñ…Ð¾Ð´Ð¸Ð¼ ÑÐ»ÐµÐ¼ÐµÐ½Ñ‚ ÐºÐ°ÑÑ‚Ð¾Ð¼Ð½Ð¾Ð³Ð¾ ÐºÑƒÑ€ÑÐ¾Ñ€Ð°
         const cursor = document.querySelector('.cursor');

         let mouseX = 0, mouseY = 0;
         let cursorX = 0, cursorY = 0;

         // ÐžÐ±Ð½Ð¾Ð²Ð»ÑÐµÐ¼ ÐºÐ¾Ð¾Ñ€Ð´Ð¸Ð½Ð°Ñ‚Ñ‹ ÐºÑƒÑ€ÑÐ¾Ñ€Ð°
         document.addEventListener('mousemove', (e) => {
             mouseX = e.clientX;
             mouseY = e.clientY;
         });

         function animateCursor() {
             // Ð—Ð°Ð¿Ð°Ð·Ð´Ñ‹Ð²Ð°ÑŽÑ‰Ð¸Ð¹ ÑÑ„Ñ„ÐµÐºÑ‚ (Ð¿Ð»Ð°Ð²Ð½Ð¾ Ð´Ð¾Ð³Ð¾Ð½ÑÐµÑ‚ ÐºÑƒÑ€ÑÐ¾Ñ€)
             cursorX += (mouseX - cursorX) * 0.1;
             cursorY += (mouseY - cursorY) * 0.1;

             cursor.style.left = `${cursorX}px`;
             cursor.style.top = `${cursorY}px`;

             requestAnimationFrame(animateCursor);
         }

         animateCursor(); // Ð—Ð°Ð¿ÑƒÑÐº Ð°Ð½Ð¸Ð¼Ð°Ñ†Ð¸Ð¸

         // Ð”Ð¾Ð±Ð°Ð²Ð»ÑÐµÐ¼ ÑÑ„Ñ„ÐµÐºÑ‚ Ð²Ð¾Ð»Ð½Ñ‹ Ð¿Ñ€Ð¸ ÐºÐ»Ð¸ÐºÐµ
         document.addEventListener('click', () => {
             cursor.classList.add('click');
             setTimeout(() => {
                 cursor.classList.remove('click');
             }, 300);
         });
         
    </script>
</body>
</html>